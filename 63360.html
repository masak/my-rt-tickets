<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>#63360: [PATCH] Update configure script and makefiles for installed Parrot</title>
    <link rel="shortcut icon" href="/rt3/NoAuth/images//favicon.png" type="image/png" />
    <link rel="stylesheet" href="/rt3/NoAuth/css/rt.perl.org/main.css" type="text/css" media="all" />
    <link rel="stylesheet" href="/rt3/NoAuth/css/print.css" type="text/css" media="print" />
    <script type="text/javascript" src="/rt3/NoAuth/js/util.js"></script>
    <script type="text/javascript" src="/rt3/NoAuth/js/titlebox-state.js"></script>
    <script type="text/javascript"><!--
        onLoadHook("loadTitleBoxStates()");
    --></script>

  </head>
  <body id="comp-Public-Bug-Display">

  <div id="logo">
    <a href="http://rt.perl.org/rt3/"><img src="/rt3/NoAuth/images//local/pblogo.gif" alt="PerlBug" width="230" height="50"></a>
  </div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
    You are currently an anonymous guest.
    |
    <a href="/rt3/NoAuth/Logout.html?URL=/rt3/index.html?goto=%252FPublic%252FBug%252FDisplay.html%253Fid%253D63360">Login</a>
    |
    <a href="/rt3/NoAuth/Logout.html">Return to Main</a>
   | <a href="/rt3/User/Prefs.html">Preferences</a>
  

  </div>



  <div id="topactions">
    <span class="topaction">
<form action="/rt3/Public/Search/Simple.html">
  <input size="12" name="q" autocomplete="off" accesskey="0" class="field" />
  <input type="submit" class="button" value="Search" />
</form>
    </span>
  </div>

</div>

<div id="nav">
<ul id="system-menu">
<div><div class="wrapper">
</div></div>
</ul>



</div>

<div id="header">
  <h1>#63360: [PATCH] Update configure script and makefiles for installed Parrot</h1>

  <ul id="page-menu">
    <div><div><div>
&nbsp;
    </div></div></div>
  </ul>

</div>

<div id="body">





<a name="skipnav" id="skipnav" accesskey="8"></a>




<div class="">
  <div class="titlebox " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox--_Public_Bug_Display.html------Report information---0');" onfocus="this.blur(); return false;" title="Toggle visibility">X</a></span>
    <span class="left">Report information</span>
    <span class="right"></span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display.html------Report information---0">



      <table width="100%" class="ticket-summary">
      <tr>
	<td valign="top" width="50%" class="boxcontainer">
	  <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox--_Public_Bug_Display.html--ticket-info-basics----The Basics---0');" onfocus="this.blur(); return false;" title="Toggle visibility">X</a></span>
    <span class="left"><a href="/rt3/Ticket/Modify.html?id=63360">The Basics</a></span>
    <span class="right"></span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display.html--ticket-info-basics----The Basics---0">



	        <table>
  <tr>
    <td class="label id">Id:</td>
    <td class="value id">63360</td>
  </tr>
  <tr>
    <td class="label status">Status:</td>
    <td class="value status">open</td>
  </tr>
  <tr>
    <td class="label time left">Left:</td>
    <td class="value time left">0 min
</td>
  </tr>
  <tr>
    <td class="label priority">Priority:</td>
    <td class="value priority">0/0</td>
  </tr>
  <tr>
    <td class="label queue">Queue:</td>
    <td class="value queue">perl6
</td>
  </tr>

</table>

	      <hr class="clear" />
  </div>
</div>




</div>


	  
      <div class="ticket-info-people">
  <div class="titlebox ticket-info-people" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox--_Public_Bug_Display.html--ticket-info-people----People---0');" onfocus="this.blur(); return false;" title="Toggle visibility">X</a></span>
    <span class="left"><a href="/rt3/Ticket/ModifyPeople.html?id=63360">People</a></span>
    <span class="right"></span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display.html--ticket-info-people----People---0">



            <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">

Nobody

</td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">


allison [at] perl.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

	      <hr class="clear" />
  </div>
</div>




</div>



	</td>
	<td valign="top" width="50%" class="boxcontainer">
    
	  <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox--_Public_Bug_Display.html--ticket-info-cfs----Bug Information---0');" onfocus="this.blur(); return false;" title="Toggle visibility">X</a></span>
    <span class="left"><a href="/rt3/Ticket/Modify.html?id=63360">Bug Information</a></span>
    <span class="right"></span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display.html--ticket-info-cfs----Bug Information---0">


 
	        <table>
  <tr id="CF-18-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-19-ShowRow">
    <td class="label">Tag:</td>
    <td class="value">
Patch    </td>
  </tr>
  <tr id="CF-20-ShowRow">
    <td class="label">Platform:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-21-ShowRow">
    <td class="label">Patch Status:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


	      <hr class="clear" />
  </div>
</div>




</div>



	  <div class="ticket-info-links">
  <div class="titlebox ticket-info-links" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox--_Public_Bug_Display.html--ticket-info-links----Links---0');" onfocus="this.blur(); return false;" title="Toggle visibility">X</a></span>
    <span class="left"><a href="/rt3/Ticket/ModifyLinks.html?id=63360">Links</a></span>
    <span class="right"></span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display.html--ticket-info-links----Links---0">



	        <table>
  <tr>
    <td class="labeltop">Depends on:</td>
    <td class="value">
<ul>
</ul>
    </td>
  </tr>
  <tr>
    <td class="labeltop">Depended on by:</td>
    <td class="value">
<ul>
</ul>
    </td>
  </tr>
  <tr>
    <td class="labeltop">Parents:</td>
    <td class="value">
<ul>
</ul>
    </td>
  </tr>
  <tr>
    <td class="labeltop">Children:</td>
    <td class="value"></td>
  </tr>
  <tr>
    <td class="labeltop">Refers to:</td>
    <td class="value">
<ul>
</ul>
    </td>
  </tr>
  <tr>
    <td class="labeltop">Referred to by:</td>
    <td class="value">
    <ul>
</ul>
    </td>
  </tr>


</table>


              <hr class="clear" />
  </div>
</div>




</div>



	  <div class="">
  <div class="titlebox " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox--_Public_Bug_Display.html------Attachments---0');" onfocus="this.blur(); return false;" title="Toggle visibility">X</a></span>
    <span class="left">Attachments</span>
    <span class="right"></span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display.html------Attachments---0">





rakudo_test_from_installed_parrot.patch<br />
<ul>


<li><font size="-2">
<a href="/rt3/Ticket/Attachment/535378/253866/rakudo_test_from_installed_parrot.patch">
Mon Feb 23 18:05:50 2009 (2.1k) by allison
</a>
</font></li>
</ul>


build-from-installed-parrot.patch<br />
<ul>


<li><font size="-2">
<a href="/rt3/Ticket/Attachment/534550/253404/build-from-installed-parrot.patch">
Fri Feb 20 00:36:36 2009 (10.8k) by allison <!-- x --> at perl.org
</a>
</font></li>
</ul>


rakudo_build_rpm_7.patch<br />
<ul>


<li><font size="-2">
<a href="/rt3/Ticket/Attachment/591728/281948/rakudo_build_rpm_7.patch">
Tue Jul 28 19:03:45 2009 (4k) by wayland
</a>
</font></li>
</ul>


rakudo_build_rpm_6.patch<br />
<ul>


<li><font size="-2">
<a href="/rt3/Ticket/Attachment/590678/281460/rakudo_build_rpm_6.patch">
Sun Jul 26 23:48:22 2009 (4.9k) by wayland
</a>
</font></li>
</ul>


rakudo_build_rpm_4.patch<br />
<ul>


<li><font size="-2">
<a href="/rt3/Ticket/Attachment/569682/270650/rakudo_build_rpm_4.patch">
Sat May 30 03:28:41 2009 (27.1k) by wayland
</a>
</font></li>
</ul>


pmichaud_makefile_patch.patch<br />
<ul>


<li><font size="-2">
<a href="/rt3/Ticket/Attachment/587976/279996/pmichaud_makefile_patch.patch">
Sun Jul 19 21:22:54 2009 (11.8k) by wayland
</a>
</font></li>
</ul>


rakudo_build_rpm_5.patch<br />
<ul>


<li><font size="-2">
<a href="/rt3/Ticket/Attachment/589036/280586/rakudo_build_rpm_5.patch">
Wed Jul 22 18:27:43 2009 (25.2k) by wayland
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>



<br />



	</td>
      </tr>
    </table>





    <hr class="clear" />
  </div>
</div>




</div>



<br />




<div class="titlebox " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox--_Public_Bug_Display.html------History---0');" onfocus="this.blur(); return false;" title="Toggle visibility">X</a></span>
    <span class="left">History</span>
    <span class="right"><span style="color: black">Display mode:</span> <span class="selected">Brief headers</span> &mdash; <a href="/rt3/Ticket/Display.html?ShowHeaders=1;id=63360">Full headers</a></span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display.html------History---0">




<div id="ticket-history">
<div class="ticket-transaction message odd">

<table width="100%" cellspacing="0" cellpadding="2" border="0">
  <tr>
    <td rowspan="2" valign="top" class="type">
      <a name="txn-534550" href="/rt3/Ticket/Display.html?id=63360#txn-534550">#</a>
      &nbsp;
    </td>
    <td class="date">Fri&nbsp;Feb&nbsp;20&nbsp;00:36:36&nbsp;2009</td>
    <td class="description">
      allison <!-- x --> at perl.org -  Ticket created
    </td>
    <td class="time-taken"></td>
    <td class="actions">&nbsp;</td>
  </tr>

  <tr>
    <td colspan="4" class="content">
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value">[PATCH] Update configure script and makefiles for installed Parrot</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value">Fri, 20 Feb 2009 00:36:00 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value">rakudobug <!-- x --> at perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value">Allison Randal &lt;allison <!-- x --> at perl.org&gt;</td>
  </tr>
</table>
<div class="messagebody">
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/534550/253402/">Download &#40;untitled&#41;</a>
<span class="downloadcontenttype">
[text/plain 1k]
</span> 
</div>
<div class="messagebody">
<div class="message-stanza-depth-0">
The attached git patch updates Rakudo&#39;s Configure.pl and Makefile.in to <br />
configure and build on an installed Parrot. It also adds two makefile <br />
templates for building Rakudo&#39;s dynops and dynpmcs. Notes:<br />
<br />
- This patch will only work for Parrot r36904 or later. &#40;Parrot needed <br />
changes to the install process and tools libraries to allow running a <br />
language build from an installed Parrot. Also added a script for full <br />
makefile template processing, including conditional lines #IF, #ELSIF, <br />
#ELSE, #UNLESS.&#41;<br />
<br />
- It requires a &#39;dynext/&#39; directory in the Rakudo build directory. <br />
&#40;&#39;dynext/&#39;, &#39;library/&#39;, and &#39;includes/&#39; are the standard Parrot search <br />
paths, and will work in the language build directory or installed in <br />
&#39;languages/langname/&#39; or &#39;/install/path/languages/langname/&#39;&#41;<br />
<br />
- The change *only* uses an installed Parrot &#40;no longer uses Parrot <br />
build directory paths&#41;, but it can be installed anywhere &#40;even within <br />
the Rakudo build directory, if desired&#41;.<br />
<br />
- There&#39;s still a problem with the installed test libraries. I&#39;ll look <br />
into it and provide an additional patch.<br />
<br />
Allison<br />
</div>
</div>
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/534550/253404/build-from-installed-parrot.patch">Download build-from-installed-parrot.patch</a>
<span class="downloadcontenttype">
[text/x-patch 10.8k]
</span> 
</div>
<div class="messagebody">
<div class="message-stanza-depth-0">
From 1d65fcb4f184ca7d8c1feaeb16fef70c919f9e88 Mon Sep 17 00:00:00 2001<br />
From: Allison Randal &lt;allison <!-- x --> at parrot.org&gt;<br />
Date: Thu, 19 Feb 2009 23:45:12 -0800<br />
Subject: [PATCH] Update Configure.pl and Makefile.in to configure and build from an installed Parrot. Add two new makefiles for building dynops and dynpmcs.<br />
<br />
---<br />
 Configure.pl          |   41 +++++++++++++++-------------<br />
 build/Makefile.in     |   48 +++++++++++++-------------------<br />
 build/ops_makefile.in |   56 +++++++++++++++++++++++++++++++++++++<br />
 build/pmc_makefile.in |   73 +++++++++++++++++++++++++++++++++++++++++++++++++<br />
 4 files changed, 171 insertions&#40;+&#41;, 47 deletions&#40;-&#41;<br />
 create mode 100644 build/ops_makefile.in<br />
 create mode 100644 build/pmc_makefile.in<br />
<br />
diff --git a/Configure.pl b/Configure.pl<br />
index 2b19fda..1fc5521 100644<br />
--- a/Configure.pl<br />
+++ b/Configure.pl<br />
@@ -50,7 +50,7 @@ END<br />
 }<br />
 <br />
<div class="message-stanza-depth-1">
 #  Create the Makefile using the information we just got<br />
</div>
-create_makefile&#40;%config&#41;;<br />
+create_makefiles&#40;%config&#41;;<br />
 <br />
<div class="message-stanza-depth-1">
 #  Done.<br />
</div>
 done&#40;&#41;;<br />
@@ -90,28 +90,31 @@ sub read_parrot_config {<br />
 }<br />
 <br />
 <br />
-#  Generate a Makefile from a configuration<br />
-sub create_makefile {<br />
+#  Generate Makefiles from a configuration<br />
+sub create_makefiles {<br />
     my %config = @_;<br />
-    open my $ROOTIN, &#34;&lt;build/Makefile.in&#34; or<br />
-        die &#34;Unable to read build/Makefile.in \n&#34;;<br />
-    my $maketext = join&#40;&#39;&#39;, &lt;$ROOTIN&gt;&#41;;<br />
-    close $ROOTIN;<br />
-<br />
-    $config{&#39;win32_libparrot_copy&#39;} = $^O eq &#39;MSWin32&#39; ? &#39;copy $&#40;BUILD_DIR&#41;\libparrot.dll .&#39; : &#39;&#39;;<br />
-    $maketext =~ s/@&#40;\w+&#41;@/$config{$1}/g;<br />
-    if &#40;$^O eq &#39;MSWin32&#39;&#41; {<br />
-        $maketext =~ s{/}{\\}g;<br />
+    my %makefiles = &#40;<br />
+        &#34;build/Makefile.in&#34; =&gt; &#34;Makefile&#34;,<br />
+        &#34;build/pmc_makefile.in&#34; =&gt; &#34;src/pmc/Makefile&#34;,<br />
+        &#34;build/ops_makefile.in&#34; =&gt; &#34;src/ops/Makefile&#34;,<br />
+    &#41;;<br />
+    my $build_tool = $config{perl} . &#34; &#34; <br />
+        . $config{libdir}<br />
+        . $config{versiondir}<br />
+        . $config{slash}<br />
+        . &#34;tools&#34;<br />
+        . $config{slash}<br />
+        . &#34;dev&#34;<br />
+        . $config{slash}<br />
+        . &#34;gen_makefile.pl&#34;;<br />
+<br />
+    foreach my $template &#40;keys %makefiles&#41; {<br />
+        my $makefile = $makefiles{$template};<br />
+       print &#34;Creating $makefile\n&#34;;<br />
+        system&#40;&#34;$build_tool $template $makefile&#34;&#41;;<br />
     }<br />
-<br />
-    print &#34;Creating Makefile\n&#34;;<br />
-    open&#40;MAKEFILE, &#34;&gt;Makefile&#34;&#41; ||<br />
-        die &#34;Unable to write Makefile\n&#34;;<br />
-    print MAKEFILE $maketext;<br />
-    close&#40;MAKEFILE&#41;;<br />
 }<br />
 <br />
-<br />
 sub done {<br />
     my $make = $config{&#39;make&#39;};<br />
     print &lt;&lt;&#34;END&#34;;<br />
diff --git a/build/Makefile.in b/build/Makefile.in<br />
index 5a00f3e..b486b23 100644<br />
--- a/build/Makefile.in<br />
+++ b/build/Makefile.in<br />
@@ -5,7 +5,10 @@<br />
 PARROT_ARGS =<br />
 <br />
<div class="message-stanza-depth-1">
 # values from parrot_config<br />
</div>
-BUILD_DIR     = @build_dir@<br />
+VERSION_DIR   = @versiondir@<br />
+LIB_DIR       = @libdir@$&#40;VERSION_DIR&#41;<br />
+BIN_DIR       = @bindir@<br />
+TOOLS_DIR     = @libdir@$&#40;VERSION_DIR&#41;@slash@tools@slash@lib<br />
 LOAD_EXT      = @load_ext@<br />
 O             = @o@<br />
 EXE           = @exe@<br />
@@ -14,24 +17,21 @@ PERL          = @perl@<br />
 RM_F          = @rm_f@<br />
 <br />
<div class="message-stanza-depth-1">
 # Various paths<br />
</div>
-PARROT_DYNEXT = $&#40;BUILD_DIR&#41;/runtime/parrot/dynext<br />
-PERL6GRAMMAR  = $&#40;BUILD_DIR&#41;/runtime/parrot/library/PGE/Perl6Grammar.pbc<br />
-NQP           = $&#40;BUILD_DIR&#41;/compilers/nqp/nqp.pbc<br />
-PCT           = $&#40;BUILD_DIR&#41;/runtime/parrot/library/PCT.pbc<br />
+PARROT_DYNEXT = $&#40;LIB_DIR&#41;/dynext<br />
+PERL6GRAMMAR  = $&#40;LIB_DIR&#41;/library/PGE/Perl6Grammar.pbc<br />
+NQP           = $&#40;LIB_DIR&#41;/languages/nqp/nqp.pbc<br />
+PCT           = $&#40;LIB_DIR&#41;/library/PCT.pbc<br />
 PMC_DIR       = src/pmc<br />
-OPSDIR        = src/ops<br />
+OPS_DIR       = src/ops<br />
 OPSLIB        = perl6<br />
-OPS_FILE      = src/ops/perl6.ops<br />
+OPS_FILE      = $&#40;OPS_DIR&#41;/perl6.ops<br />
 <br />
<div class="message-stanza-depth-1">
 # Set up extensions<br />
</div>
 <br />
<div class="message-stanza-depth-1">
 # Setup some commands<br />
</div>
-PARROT        = $&#40;BUILD_DIR&#41;/parrot$&#40;EXE&#41;<br />
+PARROT        = $&#40;BIN_DIR&#41;/parrot$&#40;EXE&#41;<br />
 CAT           = $&#40;PERL&#41; -MExtUtils::Command -e cat<br />
-BUILD_DYNPMC  = $&#40;PERL&#41; $&#40;BUILD_DIR&#41;/tools/build/dynpmc.pl<br />
-BUILD_DYNOPS  = $&#40;PERL&#41; $&#40;BUILD_DIR&#41;/tools/build/dynoplibs.pl<br />
-RECONFIGURE   = $&#40;PERL&#41; $&#40;BUILD_DIR&#41;/tools/dev/reconfigure.pl<br />
-PBC_TO_EXE    = $&#40;BUILD_DIR&#41;/pbc_to_exe$&#40;EXE&#41;<br />
+PBC_TO_EXE    = $&#40;BIN_DIR&#41;/pbc_to_exe$&#40;EXE&#41;<br />
 <br />
 SOURCES = perl6.pir \<br />
   src/gen_grammar.pir \<br />
@@ -43,7 +43,7 @@ SOURCES = perl6.pir \<br />
   src/parser/methods.pir \<br />
   src/parser/quote_expression.pir \<br />
   $&#40;PERL6_GROUP&#41; \<br />
-  src/ops/perl6_ops$&#40;LOAD_EXT&#41;<br />
+  $&#40;OPS_DIR&#41;/perl6_ops$&#40;LOAD_EXT&#41;<br />
 <br />
 BUILTINS_PIR = \<br />
   src/classes/ClassHOW.pir \<br />
@@ -110,8 +110,6 @@ SETTING = \<br />
   src/setting/Pair.pm \<br />
   src/setting/Whatever.pm \<br />
 <br />
-PMCS        = perl6str objectref perl6scalar mutablevar perl6multisub<br />
-<br />
 PMC_SOURCES = $&#40;PMC_DIR&#41;/perl6str.pmc $&#40;PMC_DIR&#41;/objectref.pmc $&#40;PMC_DIR&#41;/perl6scalar.pmc \<br />
               $&#40;PMC_DIR&#41;/mutablevar.pmc $&#40;PMC_DIR&#41;/perl6multisub.pmc<br />
 <br />
@@ -157,7 +155,7 @@ all: perl6$&#40;EXE&#41;<br />
<div class="message-stanza-depth-1">
 # &#40;We&#39;re not quite ready to make this a default target.&#41;<br />
</div>
 perl6$&#40;EXE&#41;: perl6.pbc<br />
        $&#40;PBC_TO_EXE&#41; perl6.pbc<br />
-       @win32_libparrot_copy@<br />
+#IF&#40;win32&#41;:    copy $&#40;LIB_DIR&#41;\libparrot.dll .<br />
 <br />
 spectest_checkout : t/spec<br />
 <br />
@@ -190,7 +188,7 @@ Test.pir: Test.pm perl6.pbc<br />
        $&#40;PARROT&#41; $&#40;PARROT_ARGS&#41; perl6.pbc --target=pir --output=Test.pir Test.pm<br />
 <br />
 $&#40;PMC_DIR&#41;/objectref.pmc : $&#40;PMC_DIR&#41;/objectref_pmc.template build/gen_objectref_pmc.pl<br />
-       $&#40;PERL&#41; -I$&#40;BUILD_DIR&#41;/lib build/gen_objectref_pmc.pl $&#40;PMC_DIR&#41;/objectref_pmc.template \<br />
+       $&#40;PERL&#41; -I$&#40;TOOLS_DIR&#41; build/gen_objectref_pmc.pl $&#40;PMC_DIR&#41;/objectref_pmc.template \<br />
                $&#40;PMC_DIR&#41;/objectref.pmc<br />
 <br />
 src/gen_grammar.pir: $&#40;PERL6GRAMMAR&#41; src/parser/grammar.pg src/parser/grammar-oper.pg<br />
@@ -214,17 +212,11 @@ src/gen_junction.pir: build/gen_junction_pir.pl<br />
 src/gen_setting.pm: build/gen_setting_pm.pl $&#40;SETTING&#41;<br />
        $&#40;PERL&#41; build/gen_setting_pm.pl $&#40;SETTING&#41; &gt; src/gen_setting.pm<br />
 <br />
-$&#40;PERL6_GROUP&#41;: $&#40;PARROT&#41; $&#40;PMC_SOURCES&#41;<br />
-       cd $&#40;PMC_DIR&#41; &#38;&#38; $&#40;BUILD_DYNPMC&#41; generate $&#40;PMCS&#41;<br />
-       cd $&#40;PMC_DIR&#41; &#38;&#38; $&#40;BUILD_DYNPMC&#41; compile $&#40;PMCS&#41;<br />
-       cd $&#40;PMC_DIR&#41; &#38;&#38; $&#40;BUILD_DYNPMC&#41; linklibs $&#40;PMCS&#41;<br />
-       cd $&#40;PMC_DIR&#41; &#38;&#38; $&#40;BUILD_DYNPMC&#41; copy --destination=$&#40;PARROT_DYNEXT&#41; $&#40;PMCS&#41;<br />
-<br />
-src/ops/perl6_ops$&#40;LOAD_EXT&#41; : $&#40;OPS_FILE&#41;<br />
-       @cd $&#40;OPSDIR&#41; &#38;&#38; $&#40;BUILD_DYNOPS&#41; generate $&#40;OPSLIB&#41;<br />
-       @cd $&#40;OPSDIR&#41; &#38;&#38; $&#40;BUILD_DYNOPS&#41; compile $&#40;OPSLIB&#41;<br />
-       @cd $&#40;OPSDIR&#41; &#38;&#38; $&#40;BUILD_DYNOPS&#41; linklibs $&#40;OPSLIB&#41;<br />
-       @cd $&#40;OPSDIR&#41; &#38;&#38; $&#40;BUILD_DYNOPS&#41; copy &#34;--destination=$&#40;PARROT_DYNEXT&#41;&#34; $&#40;OPSLIB&#41;<br />
+$&#40;PERL6_GROUP&#41;: $&#40;PARROT&#41; $&#40;PMC_SOURCES&#41; $&#40;PMC_DIR&#41;/Makefile<br />
+       $&#40;MAKE&#41; $&#40;PMC_DIR&#41;<br />
+<br />
+$&#40;OPS_DIR&#41;/perl6_ops$&#40;LOAD_EXT&#41; : $&#40;OPS_FILE&#41; $&#40;OPS_DIR&#41;/Makefile<br />
+       $&#40;MAKE&#41; $&#40;OPS_DIR&#41;<br />
 <br />
 <br />
<div class="message-stanza-depth-1">
 ##  local copy of Parrot<br />
</div>
diff --git a/build/ops_makefile.in b/build/ops_makefile.in<br />
new file mode 100644<br />
index 0000000..94e9298<br />
--- /dev/null<br />
+++ b/build/ops_makefile.in<br />
@@ -0,0 +1,56 @@<br />
+# Copyright &#40;C&#41; 2009, The Perl Foundation.<br />
+# $Id: $<br />
+<br />
+PERL          = @perl@<br />
+RM_F          = @rm_f@<br />
+CHMOD         = @chmod@<br />
+CP            = @cp@<br />
+VERSION_DIR   = @versiondir@<br />
+INCLUDE_DIR   = @includedir@$&#40;VERSION_DIR&#41;<br />
+LIB_DIR       = @libdir@$&#40;VERSION_DIR&#41;<br />
+INSTALL_DIR   = ..@slash@..@slash@dynext<br />
+O             = @o@<br />
+LOAD_EXT      = @load_ext@<br />
+CC            = @cc@ -c<br />
+LD            = @ld@<br />
+LDFLAGS       = @ldflags@ @ld_debug@ @rpath_blib@ @linkflags@<br />
+LD_LOAD_FLAGS = @ld_load_flags@<br />
+CFLAGS        = @ccflags@ @cc_shared@ @cc_debug@ @ccwarn@ @cc_hasjit@ @cg_flag@ @gc_flag@<br />
+CC_OUT        = @cc_o_out@<br />
+LD_OUT        = @ld_out@<br />
+#IF&#40;parrot_is_shared&#41;:LIBPARROT = @libparrot_ldflags@<br />
+#ELSE:LIBPARROT =<br />
+<br />
+BUILD_TOOLS_DIR = $&#40;LIB_DIR&#41;@slash@tools@slash@build<br />
+OPS2C           = $&#40;PERL&#41; $&#40;BUILD_TOOLS_DIR&#41;@slash <!-- x --> at ops2c.pl<br />
+<br />
+INCLUDES        = -I$&#40;INCLUDE_DIR&#41; -I$&#40;INCLUDE_DIR&#41;@slash@pmc<br />
+LINKARGS        = $&#40;LDFLAGS&#41; $&#40;LD_LOAD_FLAGS&#41; $&#40;LIBPARROT&#41;<br />
+<br />
+OPS_FILE = perl6.ops<br />
+<br />
+<br />
+all : install<br />
+<br />
+generate : $&#40;OPS_FILE&#41;<br />
+       $&#40;OPS2C&#41; C --dynamic $&#40;OPS_FILE&#41;<br />
+       $&#40;OPS2C&#41; CSwitch --dynamic $&#40;OPS_FILE&#41;<br />
+#IF&#40;cg_flag&#41;:  $&#40;OPS2C&#41; CGoto --dynamic $&#40;OPS_FILE&#41;<br />
+#IF&#40;cg_flag&#41;:  $&#40;OPS2C&#41; CGP --dynamic $&#40;OPS_FILE&#41;<br />
+<br />
+compile : generate<br />
+       $&#40;CC&#41; $&#40;CC_OUT&#41; perl6_ops$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; perl6_ops.c<br />
+       $&#40;CC&#41; $&#40;CC_OUT&#41; perl6_ops_switch$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; perl6_ops_switch.c<br />
+#IF&#40;cg_flag&#41;:  $&#40;CC&#41; $&#40;CC_OUT&#41; perl6_ops_cg$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; perl6_ops_cg.c<br />
+#IF&#40;cg_flag&#41;:  $&#40;CC&#41; $&#40;CC_OUT&#41; perl6_ops_cgp$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; perl6_ops_cgp.c<br />
+<br />
+linklibs : compile<br />
+       $&#40;LD&#41; $&#40;LD_OUT&#41; perl6_ops$&#40;LOAD_EXT&#41; perl6_ops$&#40;O&#41; $&#40;LINKARGS&#41;<br />
+       $&#40;LD&#41; $&#40;LD_OUT&#41; perl6_ops_switch$&#40;LOAD_EXT&#41; perl6_ops_switch$&#40;O&#41; $&#40;LINKARGS&#41;<br />
+#IF&#40;cg_flag&#41;:  $&#40;LD&#41; $&#40;LD_OUT&#41; perl6_ops_cg$&#40;LOAD_EXT&#41; perl6_ops_cg$&#40;O&#41; $&#40;LINKARGS&#41;<br />
+#IF&#40;cg_flag&#41;:  $&#40;LD&#41; $&#40;LD_OUT&#41; perl6_ops_cgp$&#40;LOAD_EXT&#41; perl6_ops_cgp$&#40;O&#41; $&#40;LINKARGS&#41;<br />
+<br />
+install : linklibs<br />
+#IF&#40;cygwin or hpux&#41;:   CHMOD 0775 &#34;*$&#40;LOAD_EXT&#41;&#34;<br />
+       $&#40;CP&#41; &#34;*$&#40;LOAD_EXT&#41;&#34; $&#40;INSTALL_DIR&#41;<br />
+<br />
diff --git a/build/pmc_makefile.in b/build/pmc_makefile.in<br />
new file mode 100644<br />
index 0000000..40d71e2<br />
--- /dev/null<br />
+++ b/build/pmc_makefile.in<br />
@@ -0,0 +1,73 @@<br />
+# Copyright &#40;C&#41; 2009, The Perl Foundation.<br />
+# $Id: $<br />
+<br />
+PERL          = @perl@<br />
+RM_F          = @rm_f@<br />
+CHMOD         = @chmod@<br />
+CP            = @cp@<br />
+VERSION_DIR   = @versiondir@<br />
+INCLUDE_DIR   = @includedir@$&#40;VERSION_DIR&#41;<br />
+LIB_DIR       = @libdir@$&#40;VERSION_DIR&#41;<br />
+SRC_DIR       = @srcdir@$&#40;VERSION_DIR&#41;<br />
+INSTALL_DIR   = ../../dynext<br />
+O             = @o@<br />
+LOAD_EXT      = @load_ext@<br />
+CC            = @cc@ -c<br />
+LD            = @ld@<br />
+LDFLAGS       = @ldflags@ @ld_debug@<br />
+LD_LOAD_FLAGS = @ld_load_flags@<br />
+CFLAGS        = @ccflags@ @cc_shared@ @cc_debug@ @ccwarn@ @cc_hasjit@ @cg_flag@ @gc_flag@<br />
+CC_OUT        = @cc_o_out@<br />
+LD_OUT        = @ld_out@<br />
+#IF&#40;parrot_is_shared&#41;:LIBPARROT = @libparrot_ldflags@<br />
+#ELSE:LIBPARROT =<br />
+<br />
+BUILD_TOOLS_DIR = $&#40;LIB_DIR&#41;@slash@tools@slash@build<br />
+PMC2C_INCLUDES  = --include $&#40;SRC_DIR&#41; --include $&#40;SRC_DIR&#41;@slash@pmc<br />
+PMC2C           = $&#40;PERL&#41; $&#40;BUILD_TOOLS_DIR&#41;@slash <!-- x --> at pmc2c.pl<br />
+PMC2CD = $&#40;PMC2C&#41; --dump $&#40;PMC2C_INCLUDES&#41;<br />
+PMC2CC = $&#40;PMC2C&#41; --c $&#40;PMC2C_INCLUDES&#41;<br />
+<br />
+INCLUDES        = -I$&#40;INCLUDE_DIR&#41; -I$&#40;INCLUDE_DIR&#41;@slash@pmc<br />
+LINKARGS        = $&#40;LDFLAGS&#41; $&#40;LD_LOAD_FLAGS&#41; $&#40;LIBPARROT&#41;<br />
+<br />
+PMC_SOURCES = \<br />
+  perl6str.pmc \<br />
+  objectref.pmc \<br />
+  perl6scalar.pmc \<br />
+  mutablevar.pmc \<br />
+  perl6multisub.pmc<br />
+<br />
+PERL6_GROUP = perl6_group<br />
+<br />
+<br />
+all : install<br />
+<br />
+generate : $&#40;PMC_SOURCES&#41;<br />
+       $&#40;PMC2CD&#41; perl6str.pmc<br />
+       $&#40;PMC2CD&#41; objectref.pmc<br />
+       $&#40;PMC2CD&#41; perl6scalar.pmc<br />
+       $&#40;PMC2CD&#41; mutablevar.pmc<br />
+       $&#40;PMC2CD&#41; perl6multisub.pmc<br />
+       $&#40;PMC2CC&#41; perl6str.pmc<br />
+       $&#40;PMC2CC&#41; objectref.pmc<br />
+       $&#40;PMC2CC&#41; perl6scalar.pmc<br />
+       $&#40;PMC2CC&#41; mutablevar.pmc<br />
+       $&#40;PMC2CC&#41; perl6multisub.pmc<br />
+       $&#40;PMC2C&#41; --library $&#40;PERL6_GROUP&#41; --c $&#40;PMC_SOURCES&#41;<br />
+<br />
+compile : generate<br />
+       $&#40;CC&#41; $&#40;CC_OUT&#41; perl6str$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; perl6str.c<br />
+       $&#40;CC&#41; $&#40;CC_OUT&#41; objectref$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; objectref.c<br />
+       $&#40;CC&#41; $&#40;CC_OUT&#41; perl6scalar$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; perl6scalar.c<br />
+       $&#40;CC&#41; $&#40;CC_OUT&#41; mutablevar$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; mutablevar.c<br />
+       $&#40;CC&#41; $&#40;CC_OUT&#41; perl6multisub$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; perl6multisub.c<br />
+       $&#40;CC&#41; $&#40;CC_OUT&#41; lib-$&#40;PERL6_GROUP&#41;$&#40;O&#41; $&#40;INCLUDES&#41; $&#40;CFLAGS&#41; $&#40;PERL6_GROUP&#41;.c<br />
+<br />
+linklibs : compile<br />
+       $&#40;LD&#41; $&#40;LD_OUT&#41; $&#40;PERL6_GROUP&#41;$&#40;LOAD_EXT&#41; lib-$&#40;PERL6_GROUP&#41;$&#40;O&#41; perl6str$&#40;O&#41; objectref$&#40;O&#41; perl6scalar$&#40;O&#41; mutablevar$&#40;O&#41; perl6multisub$&#40;O&#41; $&#40;LINKARGS&#41;<br />
+<br />
+install : linklibs<br />
+#IF&#40;cygwin or hpux&#41;:   CHMOD 0775 &#34;*$&#40;LOAD_EXT&#41;&#34;<br />
+       $&#40;CP&#41; &#34;*$&#40;LOAD_EXT&#41;&#34; $&#40;INSTALL_DIR&#41;<br />
+<br />
-- <br />
1.5.6.3<br />
</div>
</div>
</div>
    </td>
  </tr>

</table>
</div>


<div class="ticket-transaction other even">

<table width="100%" cellspacing="0" cellpadding="2" border="0">
  <tr>
    <td rowspan="2" valign="top" class="type">
      <a name="txn-534556" href="/rt3/Ticket/Display.html?id=63360#txn-534556">#</a>
      &nbsp;
    </td>
    <td class="date">Fri&nbsp;Feb&nbsp;20&nbsp;00:36:39&nbsp;2009</td>
    <td class="description">
      RT_System -  Tag Patch added
    </td>
    <td class="time-taken"></td>
    <td class="actions">&nbsp;</td>
  </tr>

  <tr>
    <td colspan="4" class="content">
    </td>
  </tr>

</table>
</div>


<div class="ticket-transaction message odd">

<table width="100%" cellspacing="0" cellpadding="2" border="0">
  <tr>
    <td rowspan="2" valign="top" class="type">
      <a name="txn-535378" href="/rt3/Ticket/Display.html?id=63360#txn-535378">#</a>
      &nbsp;
    </td>
    <td class="date">Mon&nbsp;Feb&nbsp;23&nbsp;18:05:50&nbsp;2009</td>
    <td class="description">
      allison -  Correspondence added
    </td>
    <td class="time-taken"></td>
    <td class="actions">&nbsp;</td>
  </tr>

  <tr>
    <td colspan="4" class="content">
<table>
</table>
<div class="messagebody">
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/535378/253860/">Download &#40;untitled&#41;</a>
<span class="downloadcontenttype">
[text/plain 354b]
</span> 
</div>
<div class="messagebody">
<div class="message-stanza-depth-0">
On Fri Feb 20 00:36:36 2009, allison <!-- x --> at perl.org wrote:<br />
<div class="message-stanza-depth-1">
&gt; <br />
&gt; - There&#39;s still a problem with the installed test libraries. I&#39;ll look <br />
&gt; into it and provide an additional patch.<br />
</div>
<br />
Ah, it wasn&#39;t a problem with the test libraries, just with Rakudo&#39;s<br />
t/harness &#40;using a hardcoded path to the parrot executable&#41;. Attached<br />
git patch to fix the test target.<br />
<br />
Allison<br />
</div>
</div>
</div>
<table>
</table>
<div class="messagebody">
<table>
</table>
<div class="messagebody">
<div class="message-stanza-depth-0">

</div>
</div>
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/535378/253866/rakudo_test_from_installed_parrot.patch">Download rakudo_test_from_installed_parrot.patch</a>
<span class="downloadcontenttype">
[text/x-diff 2.1k]
</span> 
</div>
<div class="messagebody">
<div class="message-stanza-depth-0">
From 90672654a8f2600dbc8b67f4f46286d1ed2b7279 Mon Sep 17 00:00:00 2001<br />
From: Allison Randal &lt;allison <!-- x --> at parrot.org&gt;<br />
Date: Mon, 23 Feb 2009 18:03:30 -0800<br />
Subject: [PATCH] Also fix t/harness to use installed Parrot executable when requested, instead of looking for the executable in a &#39;parrot/&#39; subdirectory.<br />
<br />
---<br />
 build/Makefile.in |    4 ++--<br />
 t/harness         |   16 ++++++++++------<br />
 2 files changed, 12 insertions&#40;+&#41;, 8 deletions&#40;-&#41;<br />
<br />
diff --git a/build/Makefile.in b/build/Makefile.in<br />
index 3244ff0..9c88b2e 100644<br />
--- a/build/Makefile.in<br />
+++ b/build/Makefile.in<br />
@@ -149,7 +149,7 @@ CLEANUPS = \<br />
 <br />
<div class="message-stanza-depth-1">
 # NOTE: eventually, we should remove --keep-exit-code and --fudge<br />
 #       as the goal is that all tests must pass without fudge<br />
</div>
-HARNESS_WITH_FUDGE = $&#40;PERL&#41; t/harness --fudge --keep-exit-code<br />
+HARNESS_WITH_FUDGE = $&#40;PERL&#41; -I$&#40;TOOLS_DIR&#41; t/harness --bindir=$&#40;BIN_DIR&#41; --fudge --keep-exit-code<br />
 HARNESS_WITH_FUDGE_JOBS = $&#40;HARNESS_WITH_FUDGE&#41; --jobs<br />
 <br />
 <br />
@@ -243,7 +243,7 @@ codetest:<br />
 <br />
 coretest: perl6.pbc<br />
<div class="message-stanza-depth-1">
 #      prove t/pmc<br />
</div>
-       $&#40;PERL&#41; t/harness t/00-parrot t/01-sanity<br />
+       $&#40;PERL&#41; -I$&#40;TOOLS_DIR&#41; t/harness --bindir=$&#40;BIN_DIR&#41; t/00-parrot t/01-sanity<br />
 <br />
 fulltest: coretest spectest codetest<br />
 <br />
diff --git a/t/harness b/t/harness<br />
index 48f2aab..26327fe 100644<br />
--- a/t/harness<br />
+++ b/t/harness<br />
@@ -20,21 +20,25 @@ our %harness_args = &#40;<br />
     verbosity =&gt; 0,<br />
 &#41;;<br />
 <br />
-if &#40;-d &#39;parrot&#39;&#41; {<br />
-    $harness_args{exec}     = [&#39;parrot/parrot&#39;, &#39;perl6.pbc&#39;];<br />
-} else {<br />
-    $harness_args{compiler} = &#39;perl6.pbc&#39;;<br />
-}<br />
-<br />
 GetOptions&#40;<br />
         &#39;tests-from-file=s&#39; =&gt; \my $list_file,<br />
         &#39;fudge&#39;             =&gt; \my $do_fudge,<br />
         &#39;verbosity=i&#39;       =&gt; \$harness_args{verbosity},<br />
+        &#39;bindir=s&#39;          =&gt; \$harness_args{bindir},<br />
<div class="message-stanza-depth-1">
         # A sensible default is num_cores + 1.<br />
         # Many people have two cores these days.<br />
</div>
         &#39;jobs:3&#39;            =&gt; \$harness_args{jobs},<br />
     &#41;;<br />
 <br />
+if &#40;$harness_args{bindir}&#41; {<br />
+    $harness_args{exec}     = [$harness_args{bindir}.&#39;/parrot&#39;, &#39;perl6.pbc&#39;];<br />
+} elsif &#40;-d &#39;parrot&#39;&#41; {<br />
+    $harness_args{exec}     = [&#39;parrot/parrot&#39;, &#39;perl6.pbc&#39;];<br />
+} else {<br />
+    $harness_args{compiler} = &#39;perl6.pbc&#39;;<br />
+}<br />
+<br />
+<br />
 <br />
 my @pass_through_options = grep m/^--?[^-]/, @ARGV;<br />
 my @files = grep m/^[^-]/, @ARGV;<br />
-- <br />
1.5.6.3<br />
</div>
</div>
</div>
    </td>
  </tr>

</table>
</div>


<div class="ticket-transaction basics even">

<table width="100%" cellspacing="0" cellpadding="2" border="0">
  <tr>
    <td rowspan="2" valign="top" class="type">
      <a name="txn-535382" href="/rt3/Ticket/Display.html?id=63360#txn-535382">#</a>
      &nbsp;
    </td>
    <td class="date">Mon&nbsp;Feb&nbsp;23&nbsp;18:05:53&nbsp;2009</td>
    <td class="description">
      RT_System -  Status changed from &#39;new&#39; to &#39;open&#39;
    </td>
    <td class="time-taken"></td>
    <td class="actions">&nbsp;</td>
  </tr>

  <tr>
    <td colspan="4" class="content">
    </td>
  </tr>

</table>
</div>


<div class="ticket-transaction message odd">

<table width="100%" cellspacing="0" cellpadding="2" border="0">
  <tr>
    <td rowspan="2" valign="top" class="type">
      <a name="txn-569682" href="/rt3/Ticket/Display.html?id=63360#txn-569682">#</a>
      &nbsp;
    </td>
    <td class="date">Sat&nbsp;May&nbsp;30&nbsp;03:28:41&nbsp;2009</td>
    <td class="description">
      wayland -  Correspondence added
    </td>
    <td class="time-taken"></td>
    <td class="actions">&nbsp;</td>
  </tr>

  <tr>
    <td colspan="4" class="content">
<table>
</table>
<div class="messagebody">
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/569682/270644/">Download &#40;untitled&#41;</a>
<span class="downloadcontenttype">
[text/plain 284b]
</span> 
</div>
<div class="messagebody">
<div class="message-stanza-depth-0">
Attached an updated patch.  pmichaud has stated that he will not accept<br />
multiple make files, which this contains.  He&#39;s planning on updating the<br />
makefiles himself.  In the meantime, this patch is something which<br />
works, but which I will update when pmichaud has updated the makefile.  <br />
</div>
</div>
</div>
<table>
</table>
<div class="messagebody">
<table>
</table>
<div class="messagebody">
<div class="message-stanza-depth-0">

</div>
</div>
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/569682/270650/rakudo_build_rpm_4.patch">Download rakudo_build_rpm_4.patch</a>
<span class="downloadcontenttype">
[text/x-patch 27.1k]
</span> 
</div>
<div class="messagebody">
Message body not shown because it is too large or is not plain text.</div>
</div>
    </td>
  </tr>

</table>
</div>


<div class="ticket-transaction message even">

<table width="100%" cellspacing="0" cellpadding="2" border="0">
  <tr>
    <td rowspan="2" valign="top" class="type">
      <a name="txn-587968" href="/rt3/Ticket/Display.html?id=63360#txn-587968">#</a>
      &nbsp;
    </td>
    <td class="date">Sun&nbsp;Jul&nbsp;19&nbsp;19:56:18&nbsp;2009</td>
    <td class="description">
      wayland -  Comments added
    </td>
    <td class="time-taken"></td>
    <td class="actions">&nbsp;</td>
  </tr>

  <tr>
    <td colspan="4" class="content">
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/587968/279980/">Download &#40;untitled&#41;</a>
<span class="downloadcontenttype">
[text/plain 354b]
</span> 
</div>
<div class="messagebody">
<div class="message-stanza-depth-0">
pmichaud has done some work on getting this all to work with a single<br />
makefile.  He&#39;s done it in this branch:<br />
<br />
http://github.com/rakudo/rakudo/tree/ins<br />
<br />
Last thing I heard, he implied that it works for him, but needs some<br />
testing, especially on win32.  I don&#39;t have a win32 box, so if someone<br />
with a win32 box could help with this, that would be great!  <br />
</div>
</div>
    </td>
  </tr>

</table>
</div>


<div class="ticket-transaction message odd">

<table width="100%" cellspacing="0" cellpadding="2" border="0">
  <tr>
    <td rowspan="2" valign="top" class="type">
      <a name="txn-587976" href="/rt3/Ticket/Display.html?id=63360#txn-587976">#</a>
      &nbsp;
    </td>
    <td class="date">Sun&nbsp;Jul&nbsp;19&nbsp;21:22:54&nbsp;2009</td>
    <td class="description">
      wayland -  Comments added
    </td>
    <td class="time-taken"></td>
    <td class="actions">&nbsp;</td>
  </tr>

  <tr>
    <td colspan="4" class="content">
<table>
</table>
<div class="messagebody">
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/587976/279990/">Download &#40;untitled&#41;</a>
<span class="downloadcontenttype">
[text/plain 211b]
</span> 
</div>
<div class="messagebody">
<div class="message-stanza-depth-0">
Ok, I&#39;ve gotten a diff of pmichaud&#39;s changes on the ins branch, and<br />
attached it to this comment.  I have no idea why he got rid of the EXE<br />
variable, though; that&#39;s probably guaranteed to make it fail on win32.  <br />
</div>
</div>
</div>
<table>
</table>
<div class="messagebody">
<table>
</table>
<div class="messagebody">
<div class="message-stanza-depth-0">

</div>
</div>
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/587976/279996/pmichaud_makefile_patch.patch">Download pmichaud_makefile_patch.patch</a>
<span class="downloadcontenttype">
[text/x-patch 11.8k]
</span> 
</div>
<div class="messagebody">
<div class="message-stanza-depth-0">
diff --git a/Configure.pl b/Configure.pl<br />
index 07bbf0d..6987a7e 100644<br />
--- a/Configure.pl<br />
+++ b/Configure.pl<br />
@@ -5,11 +5,12 @@ use 5.008;<br />
 use strict;<br />
 use warnings;<br />
 use Getopt::Long;<br />
+use Cwd;<br />
 <br />
 MAIN: {<br />
     my %options;<br />
     GetOptions&#40;\%options, &#39;help!&#39;, &#39;parrot-config=s&#39;,<br />
-               &#39;gen-parrot!&#39;, &#39;gen-parrot-option=s@&#39;&#41;;<br />
+               &#39;gen-parrot!&#39;, &#39;gen-parrot-prefix=s&#39;, &#39;gen-parrot-option=s@&#39;&#41;;<br />
 <br />
<div class="message-stanza-depth-1">
     # Print help if it&#39;s requested<br />
</div>
     if &#40;$options{&#39;help&#39;}&#41; {<br />
@@ -26,7 +27,8 @@ MAIN: {<br />
<div class="message-stanza-depth-1">
     # Update/generate parrot build if needed<br />
</div>
     if &#40;$options{&#39;gen-parrot&#39;}&#41; {<br />
         my @opts    = @{ $options{&#39;gen-parrot-option&#39;} || [] };<br />
-        my @command = &#40;$^X, &#34;build/gen_parrot.pl&#34;, @opts&#41;;<br />
+        my $prefix = $options{&#39;gen-parrot-prefix&#39;} || cwd&#40;&#41;.&#34;/parrot/install&#34;;<br />
+        my @command = &#40;$^X, &#34;build/gen_parrot.pl&#34;, &#34;--prefix=$prefix&#34;, @opts&#41;;<br />
 <br />
         print &#34;Generating Parrot ...\n&#34;;<br />
         print &#34;@command\n\n&#34;;<br />
@@ -35,7 +37,7 @@ MAIN: {<br />
 <br />
<div class="message-stanza-depth-1">
     # Get a list of parrot-configs to invoke.<br />
</div>
     my @parrot_config_exe = qw&#40;<br />
-        parrot/parrot_config<br />
+        parrot/install/bin/parrot_config<br />
         ../../parrot_config<br />
         parrot_config<br />
     &#41;;<br />
diff --git a/build/Makefile.in b/build/Makefile.in<br />
index 2ec0b9a..16b23c2 100644<br />
--- a/build/Makefile.in<br />
+++ b/build/Makefile.in<br />
@@ -1,35 +1,54 @@<br />
<div class="message-stanza-depth-1">
 # Copyright &#40;C&#41; 2006-2009, The Perl Foundation.<br />
 # $Id$<br />
</div>
 <br />
-# arguments we want to run parrot with<br />
-PARROT_ARGS =<br />
+PARROT_ARGS      =<br />
 <br />
<div class="message-stanza-depth-1">
 # values from parrot_config<br />
</div>
-BUILD_DIR     = @build_dir@<br />
-LOAD_EXT      = @load_ext@<br />
+PARROT_BIN_DIR     = @bindir@<br />
+PARROT_VERSION     = @versiondir@<br />
+PARROT_INCLUDE_DIR = @includedir@$&#40;PARROT_VERSION&#41;<br />
+PARROT_LIB_DIR     = @libdir@$&#40;PARROT_VERSION&#41;<br />
+PARROT_SRC_DIR     = @srcdir@$&#40;PARROT_VERSION&#41;<br />
+<br />
+CC            = @cc@ -c<br />
+CC_OUT        = @cc_o_out@<br />
+CFLAGS        = @ccflags@ @cc_shared@ @cc_debug@ @ccwarn@ @cc_hasjit@ @cg_flag@ @gc_flag@<br />
+LD            = @ld@<br />
+LD_OUT        = @ld_out@<br />
+LDFLAGS       = @ldflags@ @ld_debug@<br />
+LD_LOAD_FLAGS = @ld_load_flags@<br />
+LIBPARROT     = @inst_libparrot_ldflags@<br />
 O             = @o@<br />
-EXE           = @exe@<br />
+LOAD_EXT      = @load_ext@<br />
 PERL          = @perl@<br />
+CP            = @cp@<br />
+MV            = @mv@<br />
 RM_F          = @rm_f@<br />
-HAS_ICU       = @has_icu@<br />
-<br />
-# Various paths<br />
-PARROT_DYNEXT = $&#40;BUILD_DIR&#41;/runtime/parrot/dynext<br />
-PERL6GRAMMAR  = $&#40;BUILD_DIR&#41;/runtime/parrot/library/PGE/Perl6Grammar.pbc<br />
-NQP           = $&#40;BUILD_DIR&#41;/compilers/nqp/nqp.pbc<br />
-PCT           = $&#40;BUILD_DIR&#41;/runtime/parrot/library/PCT.pbc<br />
-PMC_DIR       = src/pmc<br />
-OPSDIR        = src/ops<br />
-OPSLIB        = perl6<br />
-OPS_FILE      = src/ops/perl6.ops<br />
-<br />
-# Setup some commands<br />
-PARROT        = $&#40;BUILD_DIR&#41;/parrot$&#40;EXE&#41;<br />
-CAT           = $&#40;PERL&#41; -MExtUtils::Command -e cat<br />
-BUILD_DYNPMC  = $&#40;PERL&#41; $&#40;BUILD_DIR&#41;/tools/build/dynpmc.pl<br />
-BUILD_DYNOPS  = $&#40;PERL&#41; $&#40;BUILD_DIR&#41;/tools/build/dynoplibs.pl<br />
-RECONFIGURE   = $&#40;PERL&#41; $&#40;BUILD_DIR&#41;/tools/dev/reconfigure.pl<br />
-PBC_TO_EXE    = $&#40;BUILD_DIR&#41;/pbc_to_exe$&#40;EXE&#41;<br />
+<br />
+# locations of parrot resources<br />
+PARROT           = $&#40;PARROT_BIN_DIR&#41;/parrot<br />
+PBC_TO_EXE       = $&#40;PARROT_BIN_DIR&#41;/pbc_to_exe<br />
+PARROT_TOOLS_DIR = $&#40;PARROT_LIB_DIR&#41;/tools<br />
+PARROT_PERL_LIB  = $&#40;PARROT_TOOLS_DIR&#41;/lib<br />
+PERL6GRAMMAR_PBC = $&#40;PARROT_LIB_DIR&#41;/library/PGE/Perl6Grammar.pbc<br />
+NQP_PBC          = $&#40;PARROT_LIB_DIR&#41;/languages/nqp/nqp.pbc<br />
+OPS2C            = $&#40;PERL&#41; $&#40;PARROT_TOOLS_DIR&#41;/build/ops2c.pl<br />
+PMC2C            = $&#40;PERL&#41; $&#40;PARROT_TOOLS_DIR&#41;/build/pmc2c.pl<br />
+PMC2C_INCLUDES   = --include src/pmc --include $&#40;PARROT_SRC_DIR&#41; --include $&#40;PARROT_SRC_DIR&#41;/pmc<br />
+CINCLUDES        = -I$&#40;PARROT_INCLUDE_DIR&#41; -I$&#40;PARROT_INCLUDE_DIR&#41;/pmc<br />
+LINKARGS         = $&#40;LDFLAGS&#41; $&#40;LD_LOAD_FLAGS&#41; $&#40;LIBPARROT&#41;<br />
+<br />
+# our source directories<br />
+DYNEXT       = dynext<br />
+GROUP        = perl6_group<br />
+OPS          = perl6_ops<br />
+PMC_DIR      = src/pmc<br />
+OPS_DIR      = src/ops<br />
+OPS_SOURCE   = perl6.ops<br />
+<br />
+# files we create<br />
+DYNPMC         = $&#40;DYNEXT&#41;/$&#40;GROUP&#41;$&#40;LOAD_EXT&#41;<br />
+DYNOPS         = $&#40;DYNEXT&#41;/$&#40;OPS&#41;$&#40;LOAD_EXT&#41;<br />
 <br />
 SOURCES = perl6.pir \<br />
   src/gen_grammar.pir \<br />
@@ -47,8 +66,8 @@ SOURCES = perl6.pir \<br />
   src/parrot/misc.pir \<br />
   src/parrot/state.pir \<br />
   src/gen_uprop.pir \<br />
-  $&#40;PERL6_GROUP&#41; \<br />
-  src/ops/perl6_ops$&#40;LOAD_EXT&#41;<br />
+  $&#40;DYNPMC&#41; \<br />
+  $&#40;DYNOPS&#41;<br />
 <br />
 BUILTINS_PIR = \<br />
   src/classes/Object.pir \<br />
@@ -127,13 +146,11 @@ SETTING = \<br />
   src/setting/Temporal.pm \<br />
   src/setting/Whatever.pm \<br />
 <br />
-PMCS        = perl6str objectref perl6scalar mutablevar perl6multisub p6invocation p6opaque p6role<br />
-<br />
-PMC_SOURCES = $&#40;PMC_DIR&#41;/perl6str.pmc $&#40;PMC_DIR&#41;/objectref.pmc $&#40;PMC_DIR&#41;/perl6scalar.pmc \<br />
-              $&#40;PMC_DIR&#41;/mutablevar.pmc $&#40;PMC_DIR&#41;/perl6multisub.pmc $&#40;PMC_DIR&#41;/p6invocation.pmc \<br />
-              $&#40;PMC_DIR&#41;/p6opaque.pmc $&#40;PMC_DIR&#41;/p6role.pmc<br />
-<br />
-PERL6_GROUP = $&#40;PMC_DIR&#41;/perl6_group$&#40;LOAD_EXT&#41;<br />
+PMC_SOURCES = \<br />
+  $&#40;PMC_DIR&#41;/perl6str.pmc $&#40;PMC_DIR&#41;/objectref.pmc \<br />
+  $&#40;PMC_DIR&#41;/perl6scalar.pmc $&#40;PMC_DIR&#41;/mutablevar.pmc \<br />
+  $&#40;PMC_DIR&#41;/perl6multisub.pmc $&#40;PMC_DIR&#41;/p6invocation.pmc \<br />
+  $&#40;PMC_DIR&#41;/p6opaque.pmc $&#40;PMC_DIR&#41;/p6role.pmc<br />
 <br />
 CLEANUPS = \<br />
   perl6.pbc \<br />
@@ -144,6 +161,7 @@ CLEANUPS = \<br />
   perl6$&#40;EXE&#41; \<br />
   perl6_s1.pbc \<br />
   Test.pir \<br />
+  dynext/*$&#40;LOAD_EXT&#41; \<br />
   src/gen_*.pir \<br />
   src/gen_*.pm \<br />
   $&#40;PMC_DIR&#41;/*.h \<br />
@@ -157,17 +175,16 @@ CLEANUPS = \<br />
   $&#40;PMC_DIR&#41;/*.pdb \<br />
   $&#40;PMC_DIR&#41;/*.lib \<br />
   $&#40;PMC_DIR&#41;/objectref.pmc \<br />
-  $&#40;OPSDIR&#41;/*.h \<br />
-  $&#40;OPSDIR&#41;/*.c \<br />
-  $&#40;OPSDIR&#41;/*$&#40;O&#41; \<br />
-  $&#40;OPSDIR&#41;/*$&#40;LOAD_EXT&#41; \<br />
+  $&#40;OPS_DIR&#41;/*.h \<br />
+  $&#40;OPS_DIR&#41;/*.c \<br />
+  $&#40;OPS_DIR&#41;/*$&#40;O&#41; \<br />
+  $&#40;OPS_DIR&#41;/*$&#40;LOAD_EXT&#41; \<br />
 <br />
<div class="message-stanza-depth-1">
 # NOTE: eventually, we should remove --keep-exit-code and --fudge<br />
 #       as the goal is that all tests must pass without fudge<br />
</div>
 HARNESS_WITH_FUDGE = $&#40;PERL&#41; t/harness --fudge --keep-exit-code --icu=$&#40;HAS_ICU&#41;<br />
 HARNESS_WITH_FUDGE_JOBS = $&#40;HARNESS_WITH_FUDGE&#41; --jobs<br />
 <br />
-<br />
<div class="message-stanza-depth-1">
 # the default target<br />
</div>
 all: perl6$&#40;EXE&#41;<br />
 <br />
@@ -188,13 +205,13 @@ perl6_s1.pbc: $&#40;PARROT&#41; $&#40;SOURCES&#41; $&#40;BUILTINS_PIR&#41;<br />
        $&#40;PERL&#41; -e &#34;&#34; &gt; src/gen_setting.pir<br />
        $&#40;PARROT&#41; $&#40;PARROT_ARGS&#41; -o perl6_s1.pbc perl6.pir<br />
 <br />
-src/gen_grammar.pir: $&#40;PARROT&#41; $&#40;PERL6GRAMMAR&#41; src/parser/grammar.pg src/parser/grammar-oper.pg<br />
-       $&#40;PARROT&#41; $&#40;PARROT_ARGS&#41; $&#40;PERL6GRAMMAR&#41; \<br />
+src/gen_grammar.pir: $&#40;PARROT&#41; $&#40;PERL6GRAMMAR_PBC&#41; src/parser/grammar.pg src/parser/grammar-oper.pg<br />
+       $&#40;PARROT&#41; $&#40;PARROT_ARGS&#41; $&#40;PERL6GRAMMAR_PBC&#41; \<br />
            --output=src/gen_grammar.pir --encoding=utf8 \<br />
            src/parser/grammar.pg src/parser/grammar-oper.pg<br />
 <br />
-src/gen_actions.pir: $&#40;PARROT&#41; $&#40;NQP&#41; $&#40;PCT&#41; src/parser/actions.pm<br />
-       $&#40;PARROT&#41; $&#40;PARROT_ARGS&#41; $&#40;NQP&#41; --output=src/gen_actions.pir \<br />
+src/gen_actions.pir: $&#40;PARROT&#41; $&#40;NQP_PBC&#41; src/parser/actions.pm<br />
+       $&#40;PARROT&#41; $&#40;PARROT_ARGS&#41; $&#40;NQP_PBC&#41; --output=src/gen_actions.pir \<br />
            --encoding=fixed_8 --target=pir src/parser/actions.pm<br />
 <br />
 src/gen_builtins.pir: build/gen_builtins_pir.pl<br />
@@ -215,20 +232,8 @@ src/gen_uprop.pir: build/gen_uprop_pir.pl<br />
 src/gen_setting.pm: build/gen_setting_pm.pl $&#40;SETTING&#41;<br />
        $&#40;PERL&#41; build/gen_setting_pm.pl $&#40;SETTING&#41; &gt; src/gen_setting.pm<br />
 <br />
-$&#40;PERL6_GROUP&#41;: $&#40;PARROT&#41; $&#40;PMC_SOURCES&#41;<br />
-       cd $&#40;PMC_DIR&#41; &#38;&#38; $&#40;BUILD_DYNPMC&#41; generate $&#40;PMCS&#41;<br />
-       cd $&#40;PMC_DIR&#41; &#38;&#38; $&#40;BUILD_DYNPMC&#41; compile $&#40;PMCS&#41;<br />
-       cd $&#40;PMC_DIR&#41; &#38;&#38; $&#40;BUILD_DYNPMC&#41; linklibs $&#40;PMCS&#41;<br />
-       cd $&#40;PMC_DIR&#41; &#38;&#38; $&#40;BUILD_DYNPMC&#41; copy --destination=$&#40;PARROT_DYNEXT&#41; $&#40;PMCS&#41;<br />
-<br />
-src/ops/perl6_ops$&#40;LOAD_EXT&#41; : $&#40;PARROT&#41; $&#40;OPS_FILE&#41;<br />
-       @cd $&#40;OPSDIR&#41; &#38;&#38; $&#40;BUILD_DYNOPS&#41; generate $&#40;OPSLIB&#41;<br />
-       @cd $&#40;OPSDIR&#41; &#38;&#38; $&#40;BUILD_DYNOPS&#41; compile $&#40;OPSLIB&#41;<br />
-       @cd $&#40;OPSDIR&#41; &#38;&#38; $&#40;BUILD_DYNOPS&#41; linklibs $&#40;OPSLIB&#41;<br />
-       @cd $&#40;OPSDIR&#41; &#38;&#38; $&#40;BUILD_DYNOPS&#41; copy &#34;--destination=$&#40;PARROT_DYNEXT&#41;&#34; $&#40;OPSLIB&#41;<br />
-<br />
 $&#40;PMC_DIR&#41;/objectref.pmc : $&#40;PMC_DIR&#41;/objectref_pmc.template build/gen_objectref_pmc.pl<br />
-       $&#40;PERL&#41; -I$&#40;BUILD_DIR&#41;/lib build/gen_objectref_pmc.pl $&#40;PMC_DIR&#41;/objectref_pmc.template \<br />
+       $&#40;PERL&#41; -I$&#40;PARROT_PERL_LIB&#41; build/gen_objectref_pmc.pl $&#40;PMC_DIR&#41;/objectref_pmc.template \<br />
                $&#40;PMC_DIR&#41;/objectref.pmc<br />
 <br />
 <br />
@@ -327,20 +332,15 @@ help:<br />
        @echo &#34;  help:              Print this help message.&#34;<br />
        @echo &#34;&#34;<br />
 <br />
-Makefile: build/Makefile.in build/PARROT_REVISION $&#40;PARROT&#41; Configure.pl<br />
-       @echo &#34;&#34;<br />
-       @echo &#34;warning: Makefile is out of date... re-run Configure.pl&#34;<br />
-       @echo &#34;&#34;<br />
-<br />
+# Makefile: build/Makefile.in build/PARROT_REVISION $&#40;PARROT&#41; Configure.pl<br />
+#      @echo &#34;&#34;<br />
+#      @echo &#34;warning: Makefile is out of date... re-run Configure.pl&#34;<br />
+#      @echo &#34;&#34;<br />
+#<br />
 config:<br />
        $&#40;PERL&#41; Configure.pl<br />
        <br />
-<br />
-##  Parrot targets<br />
-parrot: build/PARROT_REVISION build/gen_parrot.pl<br />
-       $&#40;PERL&#41; Configure.pl --gen-parrot<br />
-$&#40;PARROT&#41;: <br />
-<br />
+$&#40;PARROT&#41;:<br />
 <br />
 CRITIC_FILES=Configure.pl t/harness build/ tools/<br />
 <br />
@@ -361,3 +361,43 @@ release: manifest<br />
        $&#40;PERL&#41; -ne &#39;print &#34;rakudo-$&#40;VERSION&#41;/$$_&#34;&#39; MANIFEST | \<br />
            tar -zcv -T - -f rakudo-$&#40;VERSION&#41;.tar.gz<br />
        rm rakudo-$&#40;VERSION&#41;<br />
+<br />
+$&#40;DYNPMC&#41;: $&#40;PMC_SOURCES&#41;<br />
+       $&#40;PMC2C&#41; --dump $&#40;PMC2C_INCLUDES&#41; src/pmc/objectref.pmc<br />
+       $&#40;PMC2C&#41; --dump $&#40;PMC2C_INCLUDES&#41; $&#40;PMC_SOURCES&#41;<br />
+       $&#40;PMC2C&#41; --c $&#40;PMC2C_INCLUDES&#41; $&#40;PMC_SOURCES&#41;<br />
+       $&#40;PMC2C&#41; --library $&#40;GROUP&#41; --c $&#40;PMC_SOURCES&#41;<br />
+       $&#40;CC&#41; $&#40;CC_OUT&#41; $&#40;GROUP&#41;$&#40;O&#41; -I$&#40;PMC_DIR&#41; $&#40;CINCLUDES&#41; $&#40;CFLAGS&#41; $&#40;GROUP&#41;.c<br />
+       cd $&#40;PMC_DIR&#41; &#38;&#38; $&#40;CC&#41; $&#40;CINCLUDES&#41; $&#40;CFLAGS&#41; *.c<br />
+       $&#40;LD&#41; $&#40;LD_OUT&#41;$&#40;DYNPMC&#41; $&#40;GROUP&#41;$&#40;O&#41; src/pmc/*$&#40;O&#41; $&#40;LINKARGS&#41;<br />
+<br />
+DYNOPS_TARGETS = \<br />
+       $&#40;OPS_DIR&#41;/$&#40;OPS&#41;$&#40;LOAD_EXT&#41; \<br />
+       $&#40;OPS_DIR&#41;/$&#40;OPS&#41;_switch$&#40;LOAD_EXT&#41; \<br />
+       $&#40;OPS_DIR&#41;/$&#40;OPS&#41;_cg$&#40;LOAD_EXT&#41; \<br />
+       $&#40;OPS_DIR&#41;/$&#40;OPS&#41;_cgp$&#40;LOAD_EXT&#41; \<br />
+<br />
+$&#40;DYNOPS&#41;: $&#40;DYNOPS_TARGETS&#41;<br />
+       $&#40;CP&#41; $&#40;DYNOPS_TARGETS&#41; dynext<br />
+<br />
+$&#40;OPS_DIR&#41;/$&#40;OPS&#41;$&#40;LOAD_EXT&#41;: $&#40;OPS_DIR&#41;/$&#40;OPS_SOURCE&#41;<br />
+       cd $&#40;OPS_DIR&#41; &#38;&#38; $&#40;OPS2C&#41; C --dynamic $&#40;OPS_SOURCE&#41;<br />
+       cd $&#40;OPS_DIR&#41; &#38;&#38; $&#40;CC&#41; $&#40;CC_OUT&#41; $&#40;OPS&#41;$&#40;O&#41; $&#40;CINCLUDES&#41; $&#40;CFLAGS&#41; $&#40;OPS&#41;.c<br />
+       cd $&#40;OPS_DIR&#41; &#38;&#38; $&#40;LD&#41; $&#40;LD_OUT&#41;$&#40;OPS&#41;$&#40;LOAD_EXT&#41; $&#40;OPS&#41;$&#40;O&#41; $&#40;LINKARGS&#41;<br />
+<br />
+$&#40;OPS_DIR&#41;/$&#40;OPS&#41;_switch$&#40;LOAD_EXT&#41;: $&#40;OPS_DIR&#41;/$&#40;OPS_SOURCE&#41;<br />
+       cd $&#40;OPS_DIR&#41; &#38;&#38; $&#40;OPS2C&#41; CSwitch --dynamic $&#40;OPS_SOURCE&#41;<br />
+       cd $&#40;OPS_DIR&#41; &#38;&#38; $&#40;CC&#41; $&#40;CC_OUT&#41; $&#40;OPS&#41;_switch$&#40;O&#41; $&#40;CINCLUDES&#41; $&#40;CFLAGS&#41; $&#40;OPS&#41;_switch.c<br />
+       cd $&#40;OPS_DIR&#41; &#38;&#38; $&#40;LD&#41; $&#40;LD_OUT&#41;$&#40;OPS&#41;_switch$&#40;LOAD_EXT&#41; $&#40;OPS&#41;_switch$&#40;O&#41; $&#40;LINKARGS&#41;<br />
+<br />
+$&#40;OPS_DIR&#41;/$&#40;OPS&#41;_cg$&#40;LOAD_EXT&#41;: $&#40;OPS_DIR&#41;/$&#40;OPS_SOURCE&#41;<br />
+       cd $&#40;OPS_DIR&#41; &#38;&#38; $&#40;OPS2C&#41; CGoto --dynamic $&#40;OPS_SOURCE&#41;<br />
+       cd $&#40;OPS_DIR&#41; &#38;&#38; $&#40;CC&#41; $&#40;CC_OUT&#41; $&#40;OPS&#41;_cg$&#40;O&#41; $&#40;CINCLUDES&#41; $&#40;CFLAGS&#41; $&#40;OPS&#41;_cg.c<br />
+       cd $&#40;OPS_DIR&#41; &#38;&#38; $&#40;LD&#41; $&#40;LD_OUT&#41;$&#40;OPS&#41;_cg$&#40;LOAD_EXT&#41; $&#40;OPS&#41;_cg$&#40;O&#41; $&#40;LINKARGS&#41;<br />
+<br />
+$&#40;OPS_DIR&#41;/$&#40;OPS&#41;_cgp$&#40;LOAD_EXT&#41;: $&#40;OPS_DIR&#41;/$&#40;OPS_SOURCE&#41;<br />
+       cd $&#40;OPS_DIR&#41; &#38;&#38; $&#40;OPS2C&#41; CGP --dynamic $&#40;OPS_SOURCE&#41;<br />
+       cd $&#40;OPS_DIR&#41; &#38;&#38; $&#40;CC&#41; $&#40;CC_OUT&#41; $&#40;OPS&#41;_cgp$&#40;O&#41; $&#40;CINCLUDES&#41; $&#40;CFLAGS&#41; $&#40;OPS&#41;_cgp.c<br />
+       cd $&#40;OPS_DIR&#41; &#38;&#38; $&#40;LD&#41; $&#40;LD_OUT&#41;$&#40;OPS&#41;_cgp$&#40;LOAD_EXT&#41; $&#40;OPS&#41;_cgp$&#40;O&#41; $&#40;LINKARGS&#41;<br />
+<br />
+<br />
diff --git a/build/PARROT_REVISION b/build/PARROT_REVISION<br />
index 774fa2b..bd67af6 100644<br />
--- a/build/PARROT_REVISION<br />
+++ b/build/PARROT_REVISION<br />
@@ -1 +1 @@<br />
-39308<br />
+39503<br />
diff --git a/build/gen_objectref_pmc.pl b/build/gen_objectref_pmc.pl<br />
index 7c95a58..6a90e5b 100644<br />
--- a/build/gen_objectref_pmc.pl<br />
+++ b/build/gen_objectref_pmc.pl<br />
@@ -38,7 +38,7 @@ unless &#40;-e $template&#41; {<br />
 my $template_contents = slurp&#40;$template&#41;;<br />
 <br />
<div class="message-stanza-depth-1">
 # Read v-tables list and get list of functions from it.<br />
</div>
-my $vtable_list = slurp&#40;$PConfig{build_dir}.&#39;/src/vtable.tbl&#39;&#41;;<br />
+my $vtable_list = slurp&#40;$PConfig{srcdir}.$PConfig{versiondir}.&#39;/vtable.tbl&#39;&#41;;<br />
 my @all_vtables = extract_matches&#40;$vtable_list, &#39;&#40;\w+&#41;\\&#40;&#39;&#41;;<br />
 <br />
<div class="message-stanza-depth-1">
 # Find v-table methods defined in the ObjectRef template and exclude<br />
</div>
diff --git a/build/gen_parrot.pl b/build/gen_parrot.pl<br />
index 23b548b..0342265 100644<br />
--- a/build/gen_parrot.pl<br />
+++ b/build/gen_parrot.pl<br />
@@ -32,7 +32,7 @@ close $REQ;<br />
 <br />
 {<br />
     no warnings;<br />
-    if &#40;open my $REV, &#39;-|&#39;, &#34;parrot${slash}parrot_config revision&#34;&#41; {<br />
+    if &#40;open my $REV, &#39;-|&#39;, &#34;parrot${slash}install${slash}bin${slash}parrot_config revision&#34;&#41; {<br />
         my $revision = 0+&lt;$REV&gt;;<br />
         close $REV;<br />
         if &#40;$revision &gt;= $required&#41; {<br />
@@ -66,7 +66,7 @@ system @config_command;<br />
 print &#34;\nBuilding Parrot ...\n&#34;;<br />
 my %config = read_parrot_config&#40;&#41;;<br />
 my $make = $config{&#39;make&#39;} or exit&#40;1&#41;;<br />
-system&#40;$make&#41;;<br />
+system&#40;$make, &#39;install-dev&#39;&#41;;<br />
 <br />
 sub read_parrot_config {<br />
     my %config = &#40;&#41;;<br />
diff --git a/dynext/IGNORE b/dynext/IGNORE<br />
new file mode 100644<br />
index 0000000..999fdbe<br />
--- /dev/null<br />
+++ b/dynext/IGNORE<br />
@@ -0,0 +1 @@<br />
+This space intentionally left blank.<br />
</div>
</div>
</div>
    </td>
  </tr>

</table>
</div>


<div class="ticket-transaction message even">

<table width="100%" cellspacing="0" cellpadding="2" border="0">
  <tr>
    <td rowspan="2" valign="top" class="type">
      <a name="txn-589036" href="/rt3/Ticket/Display.html?id=63360#txn-589036">#</a>
      &nbsp;
    </td>
    <td class="date">Wed&nbsp;Jul&nbsp;22&nbsp;18:27:42&nbsp;2009</td>
    <td class="description">
      wayland -  Comments added
    </td>
    <td class="time-taken"></td>
    <td class="actions">&nbsp;</td>
  </tr>

  <tr>
    <td colspan="4" class="content">
<table>
</table>
<div class="messagebody">
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/589036/280580/">Download &#40;untitled&#41;</a>
<span class="downloadcontenttype">
[text/plain 1k]
</span> 
</div>
<div class="messagebody">
<div class="message-stanza-depth-0">
On Sun Jul 19 21:22:54 2009, wayland wrote:<br />
<div class="message-stanza-depth-1">
&gt; Ok, I&#39;ve gotten a diff of pmichaud&#39;s changes on the ins branch, and<br />
&gt; attached it to this comment.  I have no idea why he got rid of the EXE<br />
&gt; variable, though; that&#39;s probably guaranteed to make it fail on win32.  <br />
</div>
<br />
Pmichaud create a new ins2 branch that was to be an improvement on the<br />
ins branch.  I applied these diffs to head, and then made some<br />
modifications of my own.  The attached patch is all the mods in ins2 +<br />
the mods needed to make Rakudo work as an RPM.  <br />
<br />
The patch contains a MANIFEST.generated which pmichaud has specifically<br />
said that he does not like.  To eliminate this, it would be necessary<br />
only to rewrite &#34;make install&#34; so that it&#39;s different.  This would also<br />
eliminate the &#34;install_files.pl&#34; script.  <br />
<br />
The changes to Makefile.in should probably all be applied regardless,<br />
except the &#34;install&#34; target.  The rakudo.spec file should need no<br />
changes; it just calls &#34;make install&#34;.  <br />
<br />
I don&#39;t have a clear enough picture of what pmichaud wants in his &#34;make<br />
install&#34; section, which is why I&#39;ve left it to him.  <br />
<br />
HTH some.  <br />
</div>
</div>
</div>
<table>
</table>
<div class="messagebody">
<table>
</table>
<div class="messagebody">
<div class="message-stanza-depth-0">

</div>
</div>
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/589036/280586/rakudo_build_rpm_5.patch">Download rakudo_build_rpm_5.patch</a>
<span class="downloadcontenttype">
[text/x-patch 25.2k]
</span> 
</div>
<div class="messagebody">
Message body not shown because it is too large or is not plain text.</div>
</div>
    </td>
  </tr>

</table>
</div>


<div class="ticket-transaction message odd">

<table width="100%" cellspacing="0" cellpadding="2" border="0">
  <tr>
    <td rowspan="2" valign="top" class="type">
      <a name="txn-590678" href="/rt3/Ticket/Display.html?id=63360#txn-590678">#</a>
      &nbsp;
    </td>
    <td class="date">Sun&nbsp;Jul&nbsp;26&nbsp;23:48:22&nbsp;2009</td>
    <td class="description">
      wayland -  Correspondence added
    </td>
    <td class="time-taken"></td>
    <td class="actions">&nbsp;</td>
  </tr>

  <tr>
    <td colspan="4" class="content">
<table>
</table>
<div class="messagebody">
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/590678/281454/">Download &#40;untitled&#41;</a>
<span class="downloadcontenttype">
[text/plain 315b]
</span> 
</div>
<div class="messagebody">
<div class="message-stanza-depth-0">
Ok, here&#39;s a new patch against the updated ins2 branch.  pmichaud has<br />
done some &#34;make install&#34; stuff, and I&#39;ve added to it as required for<br />
building RPMs.  Other than adding a few useful files to the installation<br />
image &#40;ie. the setting *.pm files could come in handy&#41;, it should have<br />
no effect on non-RPM installs.  <br />
</div>
</div>
</div>
<table>
</table>
<div class="messagebody">
<table>
</table>
<div class="messagebody">
<div class="message-stanza-depth-0">

</div>
</div>
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/590678/281460/rakudo_build_rpm_6.patch">Download rakudo_build_rpm_6.patch</a>
<span class="downloadcontenttype">
[text/x-patch 4.9k]
</span> 
</div>
<div class="messagebody">
<div class="message-stanza-depth-0">
diff --git a/build/Makefile.in b/build/Makefile.in<br />
index 9ee3f7b..68c03b4 100644<br />
--- a/build/Makefile.in<br />
+++ b/build/Makefile.in<br />
@@ -1,6 +1,8 @@<br />
<div class="message-stanza-depth-1">
 # Copyright &#40;C&#41; 2006-2009, The Perl Foundation.<br />
 # $Id$<br />
</div>
 <br />
+DESTDIR         :=<br />
+<br />
 PARROT_ARGS      =<br />
 <br />
<div class="message-stanza-depth-1">
 # values from parrot_config<br />
</div>
@@ -204,13 +206,20 @@ all: $&#40;PERL6EXE&#41;<br />
 <br />
<div class="message-stanza-depth-1">
 # the install target<br />
</div>
 install: all<br />
-       $&#40;MKPATH&#41;                     $&#40;PERL6_LANG_DIR&#41;/lib<br />
-       $&#40;CP&#41;     perl6.pbc           $&#40;PERL6_LANG_DIR&#41;<br />
-       $&#40;CP&#41;     Test.pm             $&#40;PERL6_LANG_DIR&#41;/lib<br />
-       $&#40;CP&#41;     lib/*.pm            $&#40;PERL6_LANG_DIR&#41;/lib<br />
-       $&#40;CP&#41;     $&#40;DYNPMC&#41; $&#40;DYNOPS&#41; $&#40;PARROT_LIB_DIR&#41;/dynext<br />
-       $&#40;CP&#41;     $&#40;PERL6EXE&#41;         $&#40;PARROT_BIN_DIR&#41;<br />
-       $&#40;CHMOD&#41; 755 $&#40;PARROT_BIN_DIR&#41;/$&#40;PERL6EXE&#41;<br />
+       $&#40;MKPATH&#41;                     $&#40;DESTDIR&#41;/$&#40;PERL6_LANG_DIR&#41;/lib<br />
+       $&#40;CP&#41;     perl6.pbc           $&#40;DESTDIR&#41;/$&#40;PERL6_LANG_DIR&#41;<br />
+       $&#40;CP&#41;     Test.pm             $&#40;DESTDIR&#41;/$&#40;PERL6_LANG_DIR&#41;/lib<br />
+       $&#40;CP&#41;     lib/*.pm            $&#40;DESTDIR&#41;/$&#40;PERL6_LANG_DIR&#41;/lib<br />
+       $&#40;CP&#41;     src/setting/*.pm    $&#40;DESTDIR&#41;/$&#40;PERL6_LANG_DIR&#41;/lib<br />
+       $&#40;MKPATH&#41;                     $&#40;DESTDIR&#41;/$&#40;PERL6_LANG_DIR&#41;/lib/IO<br />
+       $&#40;CP&#41;     src/setting/IO/*.pm $&#40;DESTDIR&#41;/$&#40;PERL6_LANG_DIR&#41;/lib/IO<br />
+       $&#40;MKPATH&#41;                     $&#40;DESTDIR&#41;/$&#40;PERL6_LANG_DIR&#41;/lib/IO/Socket<br />
+       $&#40;CP&#41;     src/setting/IO/Socket/*.pm $&#40;DESTDIR&#41;/$&#40;PERL6_LANG_DIR&#41;/lib/IO/Socket<br />
+       $&#40;MKPATH&#41;                     $&#40;DESTDIR&#41;/$&#40;PARROT_LIB_DIR&#41;/dynext<br />
+       $&#40;CP&#41;     $&#40;DYNPMC&#41; $&#40;DYNOPS&#41; $&#40;DESTDIR&#41;/$&#40;PARROT_LIB_DIR&#41;/dynext<br />
+       $&#40;MKPATH&#41;                     $&#40;DESTDIR&#41;/$&#40;PARROT_BIN_DIR&#41;<br />
+       $&#40;CP&#41;     $&#40;PERL6EXE&#41;         $&#40;DESTDIR&#41;/$&#40;PARROT_BIN_DIR&#41;<br />
+       $&#40;CHMOD&#41;  755                 $&#40;DESTDIR&#41;/$&#40;PARROT_BIN_DIR&#41;/$&#40;PERL6EXE&#41;<br />
 <br />
 xmas: perl6$&#40;EXE&#41;<br />
 <br />
diff --git a/build/rakudo.spec b/build/rakudo.spec<br />
new file mode 100644<br />
index 0000000..fb06656<br />
--- /dev/null<br />
+++ b/build/rakudo.spec<br />
@@ -0,0 +1,119 @@<br />
+%define parrot_version 1.4.0<br />
+<br />
+Name:           rakudo<br />
+Version:        build20<br />
+Release:        1<br />
+Summary:        Rakudo Perl 6<br />
+License:        Artistic 2.0<br />
+Group:          Development/Libraries<br />
+URL:            http://www.rakudo.org/<br />
+Source0:        http://www.pmichaud.com/perl6/rakudo-%{version}.tar.gz<br />
+BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root-%&#40;%{__id_u} -n&#41;<br />
+BuildRequires:  parrot           &gt;= %parrot_version<br />
+BuildRequires:  parrot-devel     &gt;= %parrot_version<br />
+<br />
+%define parrot_versiondirname %{parrot_version}-devel<br />
+%define parrot_versiondirpath  %{_libdir}/parrot/%{parrot_versiondirname}<br />
+<br />
+%define parrot_dynext %{parrot_versiondirpath}/dynext<br />
+<br />
+#%define rakudo_libs %{_libdir}/perl6/rakudo<br />
+%define rakudo_libs %{parrot_versiondirpath}/languages/perl6/lib<br />
+<br />
+# Versions don&#39;t go easily in install_files.pl yet<br />
+#%define relative_rakudo_dynext %{name}/%{version}<br />
+%define relative_rakudo_dynext %{name}/dynext<br />
+%define rakudo_dynext %{parrot_dynext}/%{relative_rakudo_dynext}<br />
+<br />
+%description<br />
+Rakudo Perl 6 is an implementation of the Perl 6 specification which<br />
+runs on the Parrot virtual machine.  Perl 6 is a programming language<br />
+which supersedes earlier versions of Perl.  <br />
+<br />
+%prep<br />
+%setup -q<br />
+<br />
+%build<br />
+echo Building with root $RPM_BUILD_ROOT<br />
+%{__perl} Configure.pl<br />
+make<br />
+<br />
+%install<br />
+rm -rf $RPM_BUILD_ROOT<br />
+<br />
+make install DESTDIR=$RPM_BUILD_ROOT<br />
+#echo first find<br />
+#find $RPM_BUILD_ROOT<br />
+<br />
+#pushd $RPM_BUILD_ROOT/%{parrot_dynext}<br />
+#for i in %{relative_rakudo_dynext}/*.so; do <br />
+#      ln -s $i<br />
+#done<br />
+#popd<br />
+<br />
+#echo second find<br />
+#find $RPM_BUILD_ROOT<br />
+<br />
+%check<br />
+# make test &lt; /dev/null<br />
+# %{?_with_fulltest:make fulltest &lt; /dev/null}<br />
+# make test || :<br />
+# %{?_with_fulltest:make fulltest || :}<br />
+<br />
+%clean<br />
+rm -rf $RPM_BUILD_ROOT<br />
+<br />
+%post -p /sbin/ldconfig<br />
+<br />
+%postun -p /sbin/ldconfig<br />
+<br />
+%files<br />
+%defattr&#40;-,root,root,-&#41;<br />
+%doc CREDITS README<br />
+%doc docs<br />
+%{parrot_dynext}/perl6_group.so<br />
+%{parrot_dynext}/perl6_ops.so<br />
+%{parrot_dynext}/perl6_ops_cg.so<br />
+%{parrot_dynext}/perl6_ops_cgp.so<br />
+%{parrot_dynext}/perl6_ops_switch.so<br />
+#%{rakudo_dynext}/perl6_group.so<br />
+#%{rakudo_dynext}/perl6_ops.so<br />
+#%{rakudo_dynext}/perl6_ops_cg.so<br />
+#%{rakudo_dynext}/perl6_ops_cgp.so<br />
+#%{rakudo_dynext}/perl6_ops_switch.so<br />
+%{_bindir}/perl6<br />
+%{parrot_versiondirpath}/languages/perl6/perl6.pbc<br />
+%{rakudo_libs}/Test.pm<br />
+%{rakudo_libs}/Any-list.pm<br />
+%{rakudo_libs}/Any-num.pm<br />
+%{rakudo_libs}/Any-str.pm<br />
+%{rakudo_libs}/Array.pm<br />
+%{rakudo_libs}/Bool.pm<br />
+%{rakudo_libs}/Buf.pm<br />
+%{rakudo_libs}/Hash.pm<br />
+%{rakudo_libs}/Int.pm<br />
+%{rakudo_libs}/IO.pm<br />
+%{rakudo_libs}/IO/Socket.pm<br />
+%{rakudo_libs}/IO/Socket/INET.pm<br />
+%{rakudo_libs}/Junction.pm<br />
+%{rakudo_libs}/List.pm<br />
+%{rakudo_libs}/Match.pm<br />
+%{rakudo_libs}/Num.pm<br />
+%{rakudo_libs}/Object.pm<br />
+%{rakudo_libs}/Operators.pm<br />
+%{rakudo_libs}/Pair.pm<br />
+%{rakudo_libs}/Range.pm<br />
+%{rakudo_libs}/Safe.pm<br />
+%{rakudo_libs}/Str.pm<br />
+%{rakudo_libs}/Temporal.pm<br />
+%{rakudo_libs}/traits.pm<br />
+%{rakudo_libs}/Whatever.pm<br />
+<br />
+%changelog<br />
+* Wed Jul 22 2009 wayland &lt;wayland <!-- x --> at id.au&gt; 0.20<br />
+- Updated to latest version<br />
+<br />
+* Fri Mar  6 2009 wayland &lt;wayland <!-- x --> at id.au&gt; 0.17<br />
+- created from parrot.spec<br />
+- Didn&#39;t redo any of the files stuff<br />
+- Played with things &#39;til it worked<br />
</div>
</div>
</div>
    </td>
  </tr>

</table>
</div>


<div class="ticket-transaction message even">

<table width="100%" cellspacing="0" cellpadding="2" border="0">
  <tr>
    <td rowspan="2" valign="top" class="type">
      <a name="txn-591728" href="/rt3/Ticket/Display.html?id=63360#txn-591728">#</a>
      &nbsp;
    </td>
    <td class="date">Tue&nbsp;Jul&nbsp;28&nbsp;19:03:45&nbsp;2009</td>
    <td class="description">
      wayland -  Correspondence added
    </td>
    <td class="time-taken"></td>
    <td class="actions">&nbsp;</td>
  </tr>

  <tr>
    <td colspan="4" class="content">
<table>
</table>
<div class="messagebody">
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/591728/281942/">Download &#40;untitled&#41;</a>
<span class="downloadcontenttype">
[text/plain 76b]
</span> 
</div>
<div class="messagebody">
<div class="message-stanza-depth-0">
Attached patch is updated according to pmichauds comments on IRC recently.  <br />
</div>
</div>
</div>
<table>
</table>
<div class="messagebody">
<table>
</table>
<div class="messagebody">
<div class="message-stanza-depth-0">

</div>
</div>
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/591728/281948/rakudo_build_rpm_7.patch">Download rakudo_build_rpm_7.patch</a>
<span class="downloadcontenttype">
[text/x-patch 4k]
</span> 
</div>
<div class="messagebody">
<div class="message-stanza-depth-0">
diff --git a/build/Makefile.in b/build/Makefile.in<br />
index 9ee3f7b..97452a0 100644<br />
--- a/build/Makefile.in<br />
+++ b/build/Makefile.in<br />
@@ -1,6 +1,8 @@<br />
<div class="message-stanza-depth-1">
 # Copyright &#40;C&#41; 2006-2009, The Perl Foundation.<br />
 # $Id$<br />
</div>
 <br />
+DESTDIR          =<br />
+<br />
 PARROT_ARGS      =<br />
 <br />
<div class="message-stanza-depth-1">
 # values from parrot_config<br />
</div>
@@ -204,13 +206,15 @@ all: $&#40;PERL6EXE&#41;<br />
 <br />
<div class="message-stanza-depth-1">
 # the install target<br />
</div>
 install: all<br />
-       $&#40;MKPATH&#41;                     $&#40;PERL6_LANG_DIR&#41;/lib<br />
-       $&#40;CP&#41;     perl6.pbc           $&#40;PERL6_LANG_DIR&#41;<br />
-       $&#40;CP&#41;     Test.pm             $&#40;PERL6_LANG_DIR&#41;/lib<br />
-       $&#40;CP&#41;     lib/*.pm            $&#40;PERL6_LANG_DIR&#41;/lib<br />
-       $&#40;CP&#41;     $&#40;DYNPMC&#41; $&#40;DYNOPS&#41; $&#40;PARROT_LIB_DIR&#41;/dynext<br />
-       $&#40;CP&#41;     $&#40;PERL6EXE&#41;         $&#40;PARROT_BIN_DIR&#41;<br />
-       $&#40;CHMOD&#41; 755 $&#40;PARROT_BIN_DIR&#41;/$&#40;PERL6EXE&#41;<br />
+       $&#40;MKPATH&#41;                     $&#40;DESTDIR&#41;/$&#40;PERL6_LANG_DIR&#41;/lib<br />
+       $&#40;CP&#41;     perl6.pbc           $&#40;DESTDIR&#41;/$&#40;PERL6_LANG_DIR&#41;<br />
+       $&#40;CP&#41;     Test.pm             $&#40;DESTDIR&#41;/$&#40;PERL6_LANG_DIR&#41;/lib<br />
+       $&#40;CP&#41;     lib/*.pm            $&#40;DESTDIR&#41;/$&#40;PERL6_LANG_DIR&#41;/lib<br />
+       $&#40;MKPATH&#41;                     $&#40;DESTDIR&#41;/$&#40;PARROT_LIB_DIR&#41;/dynext<br />
+       $&#40;CP&#41;     $&#40;DYNPMC&#41; $&#40;DYNOPS&#41; $&#40;DESTDIR&#41;/$&#40;PARROT_LIB_DIR&#41;/dynext<br />
+       $&#40;MKPATH&#41;                     $&#40;DESTDIR&#41;/$&#40;PARROT_BIN_DIR&#41;<br />
+       $&#40;CP&#41;     $&#40;PERL6EXE&#41;         $&#40;DESTDIR&#41;/$&#40;PARROT_BIN_DIR&#41;<br />
+       $&#40;CHMOD&#41;  755                 $&#40;DESTDIR&#41;/$&#40;PARROT_BIN_DIR&#41;/$&#40;PERL6EXE&#41;<br />
 <br />
 xmas: perl6$&#40;EXE&#41;<br />
 <br />
diff --git a/build/rakudo.spec b/build/rakudo.spec<br />
new file mode 100644<br />
index 0000000..39239e5<br />
--- /dev/null<br />
+++ b/build/rakudo.spec<br />
@@ -0,0 +1,96 @@<br />
+%define parrot_version 1.4.0<br />
+<br />
+Name:           rakudo<br />
+Version:        build20<br />
+Release:        1<br />
+Summary:        Rakudo Perl 6<br />
+License:        Artistic 2.0<br />
+Group:          Development/Libraries<br />
+URL:            http://www.rakudo.org/<br />
+Source0:        http://www.pmichaud.com/perl6/rakudo-%{version}.tar.gz<br />
+BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root-%&#40;%{__id_u} -n&#41;<br />
+BuildRequires:  parrot           &gt;= %parrot_version<br />
+BuildRequires:  parrot-devel     &gt;= %parrot_version<br />
+<br />
+%define parrot_versiondirname %{parrot_version}-devel<br />
+%define parrot_versiondirpath  %{_libdir}/parrot/%{parrot_versiondirname}<br />
+<br />
+%define parrot_dynext %{parrot_versiondirpath}/dynext<br />
+<br />
+#%define rakudo_libs %{_libdir}/perl6/rakudo<br />
+%define rakudo_libs %{parrot_versiondirpath}/languages/perl6/lib<br />
+<br />
+# Versions don&#39;t go easily in install_files.pl yet<br />
+#%define relative_rakudo_dynext %{name}/%{version}<br />
+%define relative_rakudo_dynext %{name}/dynext<br />
+%define rakudo_dynext %{parrot_dynext}/%{relative_rakudo_dynext}<br />
+<br />
+%description<br />
+Rakudo Perl 6 is an implementation of the Perl 6 specification which<br />
+runs on the Parrot virtual machine.  Perl 6 is a programming language<br />
+which supersedes earlier versions of Perl.  <br />
+<br />
+%prep<br />
+%setup -q<br />
+<br />
+%build<br />
+echo Building with root $RPM_BUILD_ROOT<br />
+%{__perl} Configure.pl<br />
+make<br />
+<br />
+%install<br />
+rm -rf $RPM_BUILD_ROOT<br />
+<br />
+make install DESTDIR=$RPM_BUILD_ROOT<br />
+#echo first find<br />
+#find $RPM_BUILD_ROOT<br />
+<br />
+#pushd $RPM_BUILD_ROOT/%{parrot_dynext}<br />
+#for i in %{relative_rakudo_dynext}/*.so; do <br />
+#      ln -s $i<br />
+#done<br />
+#popd<br />
+<br />
+#echo second find<br />
+#find $RPM_BUILD_ROOT<br />
+<br />
+%check<br />
+# make test &lt; /dev/null<br />
+# %{?_with_fulltest:make fulltest &lt; /dev/null}<br />
+# make test || :<br />
+# %{?_with_fulltest:make fulltest || :}<br />
+<br />
+%clean<br />
+rm -rf $RPM_BUILD_ROOT<br />
+<br />
+%post -p /sbin/ldconfig<br />
+<br />
+%postun -p /sbin/ldconfig<br />
+<br />
+%files<br />
+%defattr&#40;-,root,root,-&#41;<br />
+%doc CREDITS README<br />
+%doc docs<br />
+%{parrot_dynext}/perl6_group.so<br />
+%{parrot_dynext}/perl6_ops.so<br />
+%{parrot_dynext}/perl6_ops_cg.so<br />
+%{parrot_dynext}/perl6_ops_cgp.so<br />
+%{parrot_dynext}/perl6_ops_switch.so<br />
+#%{rakudo_dynext}/perl6_group.so<br />
+#%{rakudo_dynext}/perl6_ops.so<br />
+#%{rakudo_dynext}/perl6_ops_cg.so<br />
+#%{rakudo_dynext}/perl6_ops_cgp.so<br />
+#%{rakudo_dynext}/perl6_ops_switch.so<br />
+%{_bindir}/perl6<br />
+%{parrot_versiondirpath}/languages/perl6/perl6.pbc<br />
+%{rakudo_libs}/Test.pm<br />
+%{rakudo_libs}/Safe.pm<br />
+<br />
+%changelog<br />
+* Wed Jul 22 2009 wayland &lt;wayland <!-- x --> at id.au&gt; 0.20<br />
+- Updated to latest version<br />
+<br />
+* Fri Mar  6 2009 wayland &lt;wayland <!-- x --> at id.au&gt; 0.17<br />
+- created from parrot.spec<br />
+- Didn&#39;t redo any of the files stuff<br />
+- Played with things &#39;til it worked<br />
</div>
</div>
</div>
    </td>
  </tr>

</table>
</div>


<div class="ticket-transaction message odd">

<table width="100%" cellspacing="0" cellpadding="2" border="0">
  <tr>
    <td rowspan="2" valign="top" class="type">
      <a name="txn-591958" href="/rt3/Ticket/Display.html?id=63360#txn-591958">#</a>
      &nbsp;
    </td>
    <td class="date">Wed&nbsp;Jul&nbsp;29&nbsp;10:16:15&nbsp;2009</td>
    <td class="description">
      pmichaud -  Correspondence added
    </td>
    <td class="time-taken"></td>
    <td class="actions">&nbsp;</td>
  </tr>

  <tr>
    <td colspan="4" class="content">
<table>
</table>
 
<div class="downloadattachment">
 
<a href="/rt3/Ticket/Attachment/591958/282068/">Download &#40;untitled&#41;</a>
<span class="downloadcontenttype">
[text/plain 295b]
</span> 
</div>
<div class="messagebody">
<div class="message-stanza-depth-0">
On Tue Jul 28 19:03:45 2009, wayland wrote:<br />
<div class="message-stanza-depth-1">
&gt; Attached patch is updated according to pmichauds comments on IRC<br />
</div>
recently.  <br />
<br />
Patch applied to ins2 branch in ce21ff.<br />
<br />
As soon as we get the Sun compiler issues resolved &#40;RT #66560&#41; I think<br />
we may be able to merge to trunk and close this ticket.<br />
<br />
Pm<br />
</div>
</div>
    </td>
  </tr>

</table>
</div>


</div>
    <hr class="clear" />
  </div>
</div>




 


</div>
<hr size=0>
<div>
For issues related to this RT instance (aka "perlbug"), please contact <tt>perlbug-admin at perl.org</tt>
</div>


<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-50555-18");
pageTracker._initData();
pageTracker._trackPageview();
</script>

<div id="footer">
  <p id="time">
    <span>Time to display: 3.110006</span>
  </p>

  <p id="bpscredits">
    <span>
&#187;&#124;&#171; RT 3.6.HEAD Copyright 1996-2006 <a href="http://www.bestpractical.com?rt=3.6.HEAD">Best Practical Solutions, LLC</a>.
</span>
</p>

</div>

  </body>
</html>
